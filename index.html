<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Gate Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.0.2/dist/css/coreui.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@coreui/icons@3.0.1/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div class="sidebar sidebar-dark sidebar-fixed" id="sidebar">
    <div class="sidebar-brand d-none d-md-flex">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-info">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
      </svg>
      <span class="sidebar-brand-full fw-bold ms-2 text-uppercase">Smart Gate</span>
    </div>
    <ul class="sidebar-nav" data-coreui="navigation" data-simplebar>
      <li class="nav-title">Trang chủ</li>
      <li class="nav-item"><a class="nav-link" href="index.html"><i class="nav-icon cil-speedometer"></i> Dashboard</a></li>
      <li class="nav-title">Chức năng</li>
      <li class="nav-item"><a class="nav-link" href="camera.html"><i class="nav-icon cil-camera"></i> Giám sát Camera</a></li>
      <li class="nav-item"><a class="nav-link" href="history.html"><i class="nav-icon cil-history"></i> Lịch sử hoạt động</a></li>
      <li class="nav-item"><a class="nav-link" href="setting.html"><i class="nav-icon cil-settings"></i> Cài đặt</a></li>
      <li class="nav-item"><a class="nav-link" href="map.html"><i class="nav-icon cil-map"></i> Bản đồ trạm</a></li>
      <li class="nav-title">Nhóm Nghiên Cứu</li>
      <li class="nav-item"><a class="nav-link" href="people.html"><i class="nav-icon cil-people"></i> Nhóm nghiên cứu</a></li>
    </ul>
    <button class="sidebar-toggler" type="button" onclick="coreui.Sidebar.getInstance(document.querySelector('#sidebar')).toggle()"></button>
  </div>

  <div class="wrapper">
    <header class="header header-sticky mb-3 p-2">
      <div class="container-fluid">
        <button class="btn btn-outline-light d-md-none me-3" type="button" onclick="coreui.Sidebar.getInstance(document.querySelector('#sidebar')).toggle()"><i class="cil-menu"></i></button>
        <span class="text-white fw-bold fs-5">HỆ THỐNG ĐIỀU KHIỂN CỐNG</span>
        <div class="ms-auto text-white-50 small d-none d-sm-block">
             Server: <span id="serverStatus" class="text-danger fw-bold">Offline</span>
        </div>
      </div>
    </header>

    <div class="body flex-grow-1 px-3">
      <div class="container-lg">
        
        <div class="row g-3 mb-3">
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-info text-white h-100 py-2">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div><div class="fs-4 fw-bold" id="valWater">--%</div><div class="small">Mực nước</div></div>
                <i class="cil-drop fs-2 opacity-50"></i>
              </div>
              <div class="mx-3" style="height:40px;"><canvas id="chartWaterMini"></canvas></div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-primary text-white h-100 py-2">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div><div class="fs-4 fw-bold" id="valGate">ĐÓNG</div><div class="small">Trạng thái Cổng</div><small class="text-white-50 d-block mt-1" id="modeStatusText">Chế độ: <b>AUTO</b></small></div>
                <i class="cil-garage fs-2 opacity-50"></i>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-warning text-white h-100 py-2">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div><div class="fs-4 fw-bold">12</div><div class="small">Lần đóng/mở</div></div>
                <i class="cil-history fs-2 opacity-50"></i>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="card bg-danger text-white h-100 py-2">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div><div class="fs-4 fw-bold">2</div><div class="small">Cảnh báo</div></div>
                <i class="cil-warning fs-2 opacity-50"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="row g-3 mb-3">
             <div class="col-12"><h6 class="text-primary fw-bold mb-0"><i class="cil-beaker me-2"></i>CHỈ SỐ CHẤT LƯỢNG NƯỚC</h6></div>
             
             <div class="col-6 col-md-3">
                <div class="card h-100 border-start border-4 border-primary">
                    <div class="card-body p-2 d-flex align-items-center">
                        <div class="quality-icon me-3"><i class="cil-beaker"></i></div>
                        <div><div class="text-muted small fw-bold">Độ pH</div><div class="fs-5 fw-bold text-dark" id="valPH">--</div></div>
                    </div>
                </div>
             </div>
             <div class="col-6 col-md-3">
                <div class="card h-100 border-start border-4 border-danger">
                    <div class="card-body p-2 d-flex align-items-center">
                        <div class="quality-icon me-3 text-danger bg-danger-light" style="background:rgba(229,83,83,0.1)"><i class="cil-blur"></i></div>
                        <div><div class="text-muted small fw-bold">Độ đục (NTU)</div><div class="fs-5 fw-bold text-dark" id="valTurbidity">--</div></div>
                    </div>
                </div>
             </div>
             <div class="col-6 col-md-3">
                <div class="card h-100 border-start border-4 border-warning">
                    <div class="card-body p-2 d-flex align-items-center">
                        <div class="quality-icon me-3 text-warning bg-warning-light" style="background:rgba(249,177,21,0.1)"><i class="cil-thermometer"></i></div>
                        <div><div class="text-muted small fw-bold">Nhiệt độ (°C)</div><div class="fs-5 fw-bold text-dark" id="valTemp">--</div></div>
                    </div>
                </div>
             </div>
             <div class="col-6 col-md-3">
                <div class="card h-100 border-start border-4 border-success">
                    <div class="card-body p-2 d-flex align-items-center">
                        <div class="quality-icon me-3 text-success bg-success-light" style="background:rgba(46,184,92,0.1)"><i class="cil-eco"></i></div>
                        <div><div class="text-muted small fw-bold">Oxy hòa tan</div><div class="fs-5 fw-bold text-dark" id="valDO">--</div></div>
                    </div>
                </div>
             </div>
        </div>

        <div class="row mb-3">
            <div class="col-12">
                <div class="card" id="weatherCard">
                    <div class="card-body p-3">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center border-end">
                                <div class="d-flex align-items-center justify-content-center">
                                    <img id="wIcon" src="https://openweathermap.org/img/wn/02d@2x.png" width="60">
                                    <div class="ms-2 text-start">
                                        <div class="h3 mb-0 fw-bold" id="wTemp">--°C</div>
                                        <div class="text-muted small fw-bold" id="wDesc">--</div>
                                    </div>
                                </div>
                                <div class="small text-primary fw-bold mt-1"><i class="cil-location-pin"></i> <span id="wLoc">Hanoi</span></div>
                            </div>
                            
                            <div class="col-md-9">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-bold small text-secondary">DỰ BÁO 5 NGÀY (Chi tiết)</span>
                                    <div class="input-group input-group-sm" style="width:180px">
                                        <input type="text" class="form-control" id="wInput" value="Hanoi">
                                        <button class="btn btn-ghost-primary" id="wBtn"><i class="cil-reload"></i></button>
                                    </div>
                                </div>
                                <div class="d-flex gap-2 overflow-auto" id="wForecast">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-4">
            
            <div class="col-lg-8 d-flex flex-column gap-3">
                
                <div class="card shadow-sm">
                    <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                         <span class="fw-bold text-primary"><i class="cil-chart-line me-2"></i>BIỂU ĐỒ MỰC NƯỚC</span>
                         <button class="btn btn-xs btn-ghost-danger" onclick="resetChartData()">Reset</button>
                    </div>
                    <div class="card-body p-2">
                        <div style="height: 400px; width: 100%;">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm flex-grow-1">
                    <div class="card-header bg-white py-2 fw-bold d-flex justify-content-between align-items-center">
                        <span><i class="cil-video me-2"></i>CAMERA GIÁM SÁT</span>
                        <a href="camera.html" class="small text-decoration-none">Xem thêm</a>
                    </div>
                    <div class="card-body p-2">
                        <div class="row g-2 h-100">
                            <div class="col-md-6">
                                <div class="position-relative border rounded overflow-hidden bg-black h-100" style="min-height: 200px;">
                                    <img src="https://loremflickr.com/640/360/dam,water?random=1" class="w-100 h-100 object-fit-cover opacity-75">
                                    <div class="position-absolute top-0 start-0 p-2 text-white small fw-bold text-shadow">
                                        <span class="badge bg-danger me-1 animate-blink">REC</span> Cam 01
                                    </div>
                                    <div class="position-absolute bottom-0 end-0 p-2 text-white-50 small font-monospace cam-time">--:--:--</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative border rounded overflow-hidden bg-black h-100" style="min-height: 200px;">
                                    <img src="https://loremflickr.com/640/360/river?random=2" class="w-100 h-100 object-fit-cover opacity-75">
                                    <div class="position-absolute top-0 start-0 p-2 text-white small fw-bold text-shadow">
                                        <span class="badge bg-success me-1">LIVE</span> Cam 02
                                    </div>
                                    <div class="position-absolute bottom-0 end-0 p-2 text-white-50 small font-monospace cam-time">--:--:--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 d-flex flex-column gap-3">
                <div class="card border-primary shadow-sm" style="border-width:1px 0 0 0; border-top: 4px solid #321fdb">
                    <div class="card-body">
                        <h6 class="fw-bold text-primary mb-3"><i class="cil-equalizer me-2"></i>BẢNG ĐIỀU KHIỂN</h6>
                        <div class="d-grid gap-2 mb-3">
                            <button class="btn btn-light border d-flex justify-content-between align-items-center py-2" onclick="toggleMode()">
                                <span class="small fw-bold" id="modeBtnText">Chế độ: TỰ ĐỘNG</span>
                                <span class="badge bg-success rounded-pill" id="modeBadge">AUTO</span>
                            </button>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-success text-white" id="btnOpenGate" disabled>MỞ CỐNG</button>
                            <button class="btn btn-danger text-white" id="btnCloseGate" disabled>ĐÓNG CỐNG</button>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="fw-bold mb-2"><i class="cil-lan me-2"></i>MÁY CHỦ</h6>
                        <div class="input-group input-group-sm mb-2">
                            <input type="text" class="form-control" id="wsUrl" value="ws://localhost:8080">
                            <button class="btn btn-primary" id="btnWsConnect">Kết nối</button>
                        </div>
                        <small>Trạng thái: <span class="badge bg-secondary" id="wsBadge">Ngắt kết nối</span></small>
                    </div>
                </div>

                <div class="card shadow-sm flex-grow-1">
                     <div class="card-header bg-white py-2 fw-bold d-flex justify-content-between align-items-center">
                         <span><i class="cil-list me-2"></i>NHẬT KÝ</span>
                         <a href="history.html" class="small text-decoration-none">Chi tiết</a>
                     </div>
                     <ul class="list-group list-group-flush small flex-grow-1" id="logList" style="max-height: 500px; overflow-y:auto;">
                         <li class="list-group-item text-muted text-center py-5">Đang tải dữ liệu...</li>
                     </ul>
                </div>
            </div>
        </div>

      </div>
    </div>

    <footer class="footer mt-auto px-4 py-2 bg-white border-top text-center small text-muted">
        <div>© 2025 Smart Gate System.</div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.0.2/dist/js/coreui.bundle.min.js"></script>

  <script src="js/main.js"></script>
</body>
</html>